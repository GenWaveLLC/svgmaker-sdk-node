name: Test AI Release Notes

on:
  workflow_dispatch:

permissions:
  contents: read
  models: read

jobs:
  test-ai:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      models: read

    steps:
    - name: Test GitHub Models API access
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        PROMPT="Say hello in one sentence."
        PROMPT_JSON=$(echo "$PROMPT" | jq -Rs .)

        RESPONSE=$(curl -sS -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer $GITHUB_TOKEN" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          -H "Content-Type: application/json" \
          https://models.github.ai/inference/chat/completions \
          -d "{
            \"model\": \"openai/gpt-4.1\",
            \"messages\": [
              {\"role\": \"user\", \"content\": $PROMPT_JSON}
            ],
            \"temperature\": 0.3
          }")

        echo "Raw response:"
        echo "$RESPONSE" | jq .

        BODY=$(echo "$RESPONSE" | jq -r '.choices[0].message.content // empty')

        if [ -z "$BODY" ]; then
          echo "::error::AI enhancement failed â€” empty response from GitHub Models API"
          echo "Response was: $RESPONSE"
          exit 1
        fi

        echo "AI response: $BODY"
        echo "GitHub Models API access is working correctly."
